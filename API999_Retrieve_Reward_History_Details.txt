API999 - Retrieve Reward History Details


Introduction

This Retrieve Reward History Details web service retrieves a list of the Open or Open and ended reward data for a particular account including: 

	Full Reward Details (all details)
	Reward
	Payment component
	Reward component.
	Sub reward component.

Pre-Conditions
The calling system must provide a valid account that matches a person record that exists on database.
The calling system must provide a valid Reward key if rewards are to be retrieved based on the reward type. If the reward type is not supplied as input, the reward, reward, reward component and service reward component data will not be retrieved for the supplied account. 
The calling system must provide the historic flag with a value of true if Open and ended rewards are to be retrieved.


Input
The API will accept the following data:
	AccountNO
	Reward Key(s)
	Historic flag

Logic
1.	If mandatory data is not supplied, a mandatory data error is raised. If all mandatory data is present, the process continues.
2.	If the format of the supplied Account is valid, it will be used to match records on database. If the account does not exist, a ‘Account not found’ error will be returned.
3.	If a Reward Key or Reward Key(s) are supplied, a check is made to ensure each one’s validity. If not valid, an error will be sent back.
4.	If no Reward Key are supplied, an empty response is sent back, i.e. no Reward or other group tags are returned.
5.	When a account is supplied which exists on database but has no reward / rewards; an empty response is sent back, i.e. no Reward or other group tags are returned.
6.	NULL End Dated Rewards and Future End Dated Rewards only (i.e., not historically closed rewards) pertaining to the requested reward keys will be retrieved.
7.	Rewards will be retrieved in reverse chronological order (descending) by end date first (REWARD_KEY.REWARD_END_DATE) and then in reverse chronological order (descending) by start date second (REWARD_KEY. REWARD_START_DATE).
8.	For the returned Rewards only, return NULL End Dated Rewards and Future End Dated Rewards only (i.e., not historically closed rewards).
9.	All child records of any returned rewards (REWARD_COMPONENT and SUB_REWARD_COMPONENT) should be returned without filtering.
10.	Payment Status records will be retrieved in reverse chronological order (descending) by end date first (PAYMENT.PYMT_END_DATE) and then in reverse chronological order (descending) by start date second (PAYMENT.PYMT_START_DATE).  
11.	If the historic flag provided as input is “True” then 
12.	Return all rewards that are either open (NULL reward end date) or with an end date which was closed less than 10 months from current date (and thus all future end dated rewards will also be included).
13.	For the returned Rewards only, return all Rewards (i.e., regardless of open or closed or end date).
14.	For the returned Rewards only, return all Payment records (i.e., regardless of open or closed or end date).


Error Conditions
The following errors can be generated by this API:


Functional Errors:

Error 0101: “Invalid Account - format must be 999999AA”.
Error 0102: “Account Not Found - does not match any record in database.”
Error 0103: “Mandatory Data Not Supplied”
Error 0104: “Reward Key cannot be found”.


Technical Errors:

•	Oracle Error – Oracle errors generated by the system will be captured and returned to the calling system as part of the response.
•	Java Error – Java errors generated by the system will be captured and returned to the calling system as part of the response.
In each of the above functional errors an appropriate error handling mechanism should be implemented.

Input Entities

Entity	Attribute	M/O	Description
Account_Details	AccountNO	M	A Account for a person.
Reward_key	RewardKey	O	Unique identifier of a Reward
N/A	Historic Key	O	When supplied with a value of true all open and ended rewards are retrieved. 
When supplied with a value of false (or not supplied), only open records are retrieved.



Output entities.

Subject Area	Entity	M/O	Functional Specification
Account_Details	AccountNO	M	Primary Customer contact table Stores all vital data relating to a customer such as date of birth, gender.
Reward_key 	Key 	M	Unique key.
Reward_key 	Reward_Date	O	Date on which reward is made.
Reward_key 	Reward_Start_Date	O	Date on which date is to start.
Reward_key 	Reward_Receipt_Date	O	Date on which claim is received.
Reward_key	Reward_End_Date	O	reward end date
Payment	Pymt_start_date	M	Ongoing payment start date
Payment	Pymt_end_date	O	Ongoing payment end date
Person_Reward 	Reward_Start_Date	M	Reward start date.
Person_Reward 	Reward_End_Date	O	Reward end date.
Person_Reward 	Reward_Amount	O	Amount taken in reward.
Reward_Component	Cmpnt_reward_amnt	O	Amount of the component in pence
Sub_reward_component	Scheme_rate_amount	O	Inherited increments entitlement amount


Reward keys:

Note, the configuration in the table below is shared by Retrieve Reward History Details
Reward Key	Description
1	Spotlight reward
2	Best performer
3	High Five Reward
4	Teamwork Rewards
5	Ace of initiative
6	Pinnacle Reward
7	Starbucks Rewards
8	Aced Attendance

